---
title: 基于线程池队列的简单批处理操作
published: 2025-09-10
tags:
  - Java
  - 线程池
lang: zh
abbrlink:  java-threadpool-batch-operation
---

### 背景
> 日常开发中，会遇到需要进行批处理操作任务的需求，譬如批量执行查询任务，批量执行某某操作等。批处理框架有 `spring batch`、`Apache Spark`、`Apache Flink` 等，但这些框架都需要依赖于数据库，或者需要额外的配置已经非必要的功能。因此，对于一些简单的批处理任务，我们可以考虑使用线程池来实现。<br>
> 线程池的优点是无需额外导入依赖，减轻项目负担，且有现成的任务队列可以满足需求。

### 实现
**注意：** 线程池的任务队列添加任务时，是直接加入队列的，而不是等待线程池中的线程空闲后再加入。

```java
public class BatchCalManger {
    private static final ThreadPoolExecutor executor;

    static {
        // 设定的线程池最大线程数为1，队列容量为无限大且是按FIFO（先进先出）的顺序排队，线程空闲时间为0ms
        ThreadPoolExecutor executorService = new ThreadPoolExecutor(1, 1,
                0L, TimeUnit.MILLISECONDS,
                new LinkedBlockingQueue<>());
        executor = executorService;
    }


    
    public static void execute(Runnable runnable){
        executor.execute(runnable);
    }


    public static void stop() {
        //清空任务队列，已经执行的任务不会受影响
        executor.getQueue().clear();
    }
}
```
### 使用

```java
public class BatchTest {
    public static void main(String[] args) {
        BatchCalManger.execute(() -> System.out.println("hello world1"));
        BatchCalManger.execute(new Runnable() {
            @Override
            public void run() {
                System.out.println("hello world2");
            }
        });
    }
}
```

